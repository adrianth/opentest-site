<!DOCTYPE html><html lang=""><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Scripting support - OpenTest</title><link href="/css/bootstrap.min.css" rel="stylesheet"><link href="/css/asciidoctor.css" rel="stylesheet"><link href="/css/italian-pop.css" rel="stylesheet"><link href="/css/pygments.css" rel="stylesheet"><link href="/css/style.css" rel="stylesheet"><link href="/css/slick.css" rel="stylesheet"><link href="/css/menu.css" rel="stylesheet"><link href="/css/home.css" rel="stylesheet"><link href="/css/footer.css" rel="stylesheet"><link rel="stylesheet" href="/css/document.css" media="screen" type="text/css"><link href="https://fonts.googleapis.com/css?family=Rubik" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Pragati+Narrow" rel="stylesheet"> <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script><meta name="keywords" content="opentest, javascript"></head><body><div id="menu-wrapper"><div class="container"><div class="row"><nav class="navbar main-menu" role="navigation"><div class="navbar-header"> <a class="navbar-brand" href="/"> <img src="/img/common/opentest.svg" /> OpenTest </a> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-navbar-collapse-1"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button></div><div class="collapse navbar-collapse" id="bs-navbar-collapse-1"><ul class="nav navbar-nav navbar-right scrollable-menu"><li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="true">Docs <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/docs/installation.html">Installation</a></li><li><a href="/docs/architecture.html">Architecture</a></li><li><a href="/docs/test-structure.html">Test structure</a></li><li><a href="/docs/test-action-types.html">Test action types</a></li><li><a href="/docs/test-data.html">Working with test data</a></li><li><a href="/docs/passing-data.html">Passing data between test steps</a></li><li><a href="/docs/scripting-support.html">Scripting support</a></li><li><a href="/docs/data-driven-testing.html">Data-driven testing</a></li><li><a href="/docs/more.html">More...</a></li></ul></li><li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="true">Reference <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/reference/selenium-keywords.html">Selenium keywords</a></li><li><a href="/reference/appium-keywords.html">Appium keywords</a></li><li><a href="/reference/generic-keywords.html">Generic keywords</a></li><li><a href="/reference/javascript-api.html">JavaScript API</a></li><li><a href="/reference/yaml-primer.html">YAML primer</a></li></ul></li><li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="true">Tutorials <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/tutorials/selenium-testing.html">Web testing</a></li><li><a href="/tutorials/appium-testing.html">Mobile testing</a></li><li><a href="/tutorials/api-testing.html">REST API testing</a></li></ul></li></ul></div></nav></div></div></div><div class="clearfix"></div><div class="main-content"><div class="page-content"><div class="container"><div class="row"><div class="col-md-3 hidden-sm hidden-xs" id="toc-col"><div id="docs-toc"><h3>Docs</h3><ul class="dropdown-menu1"><li><a href="/docs/installation.html">Installation</a></li><li><a href="/docs/architecture.html">Architecture</a></li><li><a href="/docs/test-structure.html">Test structure</a></li><li><a href="/docs/test-action-types.html">Test action types</a></li><li><a href="/docs/test-data.html">Working with test data</a></li><li><a href="/docs/passing-data.html">Passing data between<br>test steps </a></li><li><a href="/docs/scripting-support.html">Scripting support</a></li><li><a href="/docs/data-driven-testing.html">Data-driven testing</a></li><li><a href="/docs/more.html">More...</a></li></ul><h3>Reference</h3><ul class="dropdown-menu1"><li><a href="/reference/selenium-keywords.html">Selenium keywords</a></li><li><a href="/reference/appium-keywords.html">Appium keywords</a></li><li><a href="/reference/generic-keywords.html">Generic keywords</a></li><li><a href="/reference/javascript-api.html">JavaScript API</a></li><li><a href="/reference/yaml-primer.html">YAML primer</a></li></ul><h3>Tutorials</h3><ul class="dropdown-menu1"><li><a href="/tutorials/selenium-testing.html">Web testing</a></li><li><a href="/tutorials/appium-testing.html">Mobile testing</a></li><li><a href="/tutorials/api-testing.html">REST API testing</a></li></ul></div></div><div class="col-md-9"><h1>Scripting support</h1><div class="toc-container"> <span class="toc-heading">Contents</span><ul class="sectlevel1"><li><a href="#script-actions">Script actions</a></li><li><a href="#javascript-expressions">JavaScript expressions</a><ul class="sectlevel2"><li><a href="#the-script-syntax">The $script syntax</a></li></ul></li><li><a href="#external-script-files">External script files</a></li><li><a href="#advanced-concepts">Advanced concepts</a></li></ul></div><hr><div class="paragraph"><p>Complex test scenarios demand complex logic to handle them. This is where the keyword-driven approach starts to break. To solve certain types of problems, you must roll up your sleeves and start writing some good old-fashioned code.</p></div><div class="paragraph"><p>OpenTest allows testers to use JavaScript code just about anywhere in a test, as necessary. The main techniques to embed JavaScript code in a test are:</p></div><div class="ulist"><ul><li><p>Script actions.</p></li><li><p>JavaScript expressions in test action arguments.</p></li><li><p>External script files.</p></li></ul></div><div class="sect1"><h2 id="script-actions">Script actions</h2><div class="sectionbody"><div class="paragraph"><p>Script actions can be used to embed blocks of JavaScript code anywhere in the test flow. The JavaScript code to execute must be provided as a string value in the <code>script</code> property of the test action. The simplest form of a script action looks like this:</p></div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">script</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">$log(&quot;Hellow world!&quot;)</span></code></pre></div></div><div class="paragraph"><p>Most script blocks, however, consist of multiple lines of code. To include larger code blocks we must use the YAML "|" (pipe) syntax that allows a string to span multiple lines:</p></div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">description</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">Click buttons with IDs &quot;button1&quot; to &quot;button100&quot;</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">script</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-p tok-p-Indicator">|</span>
    <span class="tok-no">for (var buttonNo = 1; buttonNo &lt;= 100; buttonNo++) {</span>
        <span class="tok-no">$runAction(&quot;org.getopentest.selenium.Click&quot;, {</span>
            <span class="tok-no">locator: { id: &quot;button&quot; + buttonNo }</span>
        <span class="tok-no">});</span>
    <span class="tok-no">}</span></code></pre></div></div></div></div><div class="sect1"><h2 id="javascript-expressions">JavaScript expressions</h2><div class="sectionbody"><div class="paragraph"><p>JavaScript expressions can be used to provide the values for test action arguments or property values in data files. Let&#8217;s consider the following example:</p></div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">description</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">Create a new blog post</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">action</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">org.getopentest.actions.HttpRequest</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">args</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">url</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">$data(&quot;urls&quot;).jsonplaceholder + &quot;/posts&quot;</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">verb</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">POST</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">contentType</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">application/json</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">body</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-p tok-p-Indicator">|</span>
      <span class="tok-no">$json(</span>
        <span class="tok-no">{</span>
          <span class="tok-no">id: 123,</span>
          <span class="tok-no">title: &quot;My fist post&quot;</span>
        <span class="tok-no">}</span>
      <span class="tok-no">)</span></code></pre></div></div><div class="paragraph"><p>The values of the <code>url</code> and the <code>body</code> arguments are JavaScript expressions. When the value of an action argument starts with a dollar-prefixed symbol like <code>$json</code> or <code>$data</code>, the test actor understands that the expression is JavaScript code. The test actor evaluates the expression and uses the result as the value for the action argument.</p></div><div class="sect2"><h3 id="the-script-syntax">The $script syntax</h3><div class="paragraph"><p>Every now and then, JavaScript expressions must start with something other than a dollar-prefixed symbol. To let the test actor know that a certain value is JavaScript code and not just an ordinary string literal, we must prefix such expressions with the syntax <code>$script</code> followed by one or more whitespace characters (space, tab, end-of-line). For example:</p></div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">description</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">Type a random user name into the &quot;username&quot; textbox</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">action</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">org.getopentest.selenium.SendKeys</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">args</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">locator</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-p tok-p-Indicator">{</span> <span class="tok-nv">id</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-nv">username</span> <span class="tok-p tok-p-Indicator">}</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">text</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">$script &quot;user&quot; + (1 + Math.floor(Math.random() * 10000))</span></code></pre></div></div></div></div></div><div class="sect1"><h2 id="external-script-files">External script files</h2><div class="sectionbody"><div class="paragraph"><p>When you need to reuse a piece of JavaScript code across multiple tests or macro actions, the best solution is to implement the logic as one or more JavaScript functions and save it in <code>*.js</code> files in the <code>scripts</code> directory of your test repo.</p></div><div class="paragraph"><p>For example, let&#8217;s assume we need a JS function to extract the first n words from a string. We can create a function called <code>excerpt</code> and place it in a <code>helpers.js</code> in the <code>scripts</code> directory:</p></div><div class="listingblock"><div class="title">test-repo-path/scripts/helpers.js</div><div class="content"><pre class="pygments highlight"><code data-lang="js"><span></span><span class="tok-kd">function</span> <span class="tok-nx">excerpt</span><span class="tok-p">(</span><span class="tok-nx">text</span><span class="tok-p">,</span> <span class="tok-nx">wordCount</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">words</span> <span class="tok-o">=</span> <span class="tok-nx">text</span><span class="tok-p">.</span><span class="tok-nx">split</span><span class="tok-p">(</span><span class="tok-s1">&#39; &#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">words</span><span class="tok-p">.</span><span class="tok-nx">splice</span><span class="tok-p">(</span><span class="tok-nx">wordCount</span> <span class="tok-o">||</span> <span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-nx">words</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">);</span>
    <span class="tok-k">return</span> <span class="tok-nx">words</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre></div></div><div class="paragraph"><p>To use this function in a test, we first need to "include" the file by using the <code>includes</code> syntax:</p></div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">description</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">Include a JS file and call a function in it</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">includes</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">helpers.js</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">actors</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">actor</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ACTOR1</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">segments</span><span class="tok-p tok-p-Indicator">:</span>
      <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">segment</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">1</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">actions</span><span class="tok-p tok-p-Indicator">:</span>
          <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">script</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-p tok-p-Indicator">|</span>
              <span class="tok-no">var text = &quot;Lorem ipsum dolor sit amet consectetur adipiscing elit&quot;</span>
              <span class="tok-no">$log(&quot;The first five words are &quot; + excerpt(text, 5).join(&quot;, &quot;));</span></code></pre></div></div><div class="paragraph"><p>To include multiple JS files, the value of the <code>includes</code> property can be specified as an array:</p></div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">includes</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-p tok-p-Indicator">[</span><span class="tok-nv">moment.min.js</span><span class="tok-p tok-p-Indicator">,</span> <span class="tok-nv">underscore.min.js</span><span class="tok-p tok-p-Indicator">,</span> <span class="tok-nv">helpers.js</span><span class="tok-p tok-p-Indicator">]</span></code></pre></div></div><div class="paragraph"><p>The files will be included in the same order they are specified in the array.</p></div></div></div><div class="sect1"><h2 id="advanced-concepts">Advanced concepts</h2><div class="sectionbody"><div class="paragraph"><p>The OpenTest actor runs JavaScript code using the Nashorn JavaScript interpreter that comes with the Java 8 runtime. There&#8217;s a lot of information about Nashorn on the web, so we will not attempt to document its features here. The one thing we would like to touch on is the <code>Java.type()</code> API that allows access to any Java class from within the JavaScript code.</p></div><div class="paragraph"><p>The sample code below uses four classes from the Java runtime to read a text file and print it&#8217;s contents to the console. Please note that we had to store the Java <code>String</code> type into a variable named <code>JavaString</code> instead of simply <code>String</code>, in order to avoid overriding the JavaScript <code>String</code> type.</p></div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="js"><span></span><span class="tok-o">-</span> <span class="tok-nx">script</span><span class="tok-o">:</span> <span class="tok-o">|</span>
    <span class="tok-kd">var</span> <span class="tok-nx">Files</span> <span class="tok-o">=</span> <span class="tok-nx">Java</span><span class="tok-p">.</span><span class="tok-nx">type</span><span class="tok-p">(</span><span class="tok-s2">&quot;java.nio.file.Files&quot;</span><span class="tok-p">);</span>
    <span class="tok-kd">var</span> <span class="tok-nx">Paths</span> <span class="tok-o">=</span> <span class="tok-nx">Java</span><span class="tok-p">.</span><span class="tok-nx">type</span><span class="tok-p">(</span><span class="tok-s2">&quot;java.nio.file.Paths&quot;</span><span class="tok-p">);</span>
    <span class="tok-kd">var</span> <span class="tok-nx">System</span> <span class="tok-o">=</span> <span class="tok-nx">Java</span><span class="tok-p">.</span><span class="tok-nx">type</span><span class="tok-p">(</span><span class="tok-s2">&quot;java.lang.System&quot;</span><span class="tok-p">);</span>
    <span class="tok-kd">var</span> <span class="tok-nx">JavaString</span> <span class="tok-o">=</span> <span class="tok-nx">Java</span><span class="tok-p">.</span><span class="tok-nx">type</span><span class="tok-p">(</span><span class="tok-s2">&quot;java.lang.String&quot;</span><span class="tok-p">);</span>

    <span class="tok-kd">var</span> <span class="tok-nx">content</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">JavaString</span><span class="tok-p">(</span><span class="tok-nx">Files</span><span class="tok-p">.</span><span class="tok-nx">readAllBytes</span><span class="tok-p">(</span><span class="tok-nx">Paths</span><span class="tok-p">.</span><span class="tok-nx">get</span><span class="tok-p">(</span><span class="tok-s2">&quot;C:/content.txt&quot;</span><span class="tok-p">)),</span> <span class="tok-s2">&quot;UTF-8&quot;</span><span class="tok-p">);</span>
    <span class="tok-nx">System</span><span class="tok-p">.</span><span class="tok-nx">out</span><span class="tok-p">.</span><span class="tok-nx">println</span><span class="tok-p">(</span><span class="tok-nx">content</span><span class="tok-p">);</span></code></pre></div></div><div class="paragraph"><p>The ability to access any Java runtime class from JavaScript gives testers unlimited power and flexibility. That being said, you should avoid the temptation to "translate" full Java applications to JavaScript. Complex applications are better kept in Java, to benefit from static typing and advanced IDE features that increase efficiency and helps minimize human error.</p></div></div></div><br><div id="disqus_thread"></div><script> (function() { var d = document, s = d.createElement('script'); s.src = 'https://getopentest.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div></div></div><footer><div class="container"><div class="row"><div class="col-sm-12"> <a href="#"><i class="fab fa-github"></i> GitHub</a>&nbsp; &nbsp;|&nbsp;&nbsp; <a href="https://github.com/mcdcorp/opentest/blob/master/LICENSE">MIT license</a></div></div></div></footer><script src="/js/jquery-2.2.4.min.js"></script> <script src="/js/side-toc.js"></script> <script src="/js/bootstrap.min.js"></script> <script src="/js/slick.min.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-73340843-6"></script> <script defer src="/js/analytics.js"></script></body></html>
